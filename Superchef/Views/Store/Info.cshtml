@model Store

@{
    ViewBag.Title = "Store Details | Superchef";
}

@section head {
    <style>
        #banner-container {
            aspect-ratio: 3 / 1;
            position: relative;
            padding-left: 0;
            padding-right: 0;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: -2rem;
        }

        #banner-container>img {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }

        #banner-container>.store-details-container {
            margin-left: var(--main-padding);
            width: max-content;
            max-width: calc(100% - (var(--main-padding) * 2));
            border: 1px solid var(--border-primary);
            padding: 1rem;
        }

        @@media (max-width: 800px) {
            #banner-container {
                padding: 0;
            }

            #banner-container>img {
                position: initial;
            }

            #banner-container>.store-details-container {
                width: 100%;
                margin-left: auto;
                margin-right: auto;
            }
        }
    </style>
}

<div id="banner-container" class="container" data-full data-no="color padding">
    <img 
        src="/uploads/@(string.IsNullOrEmpty(Model.Banner) ? $"store/{Model.Image}" : $"banner/{Model.Banner}")"
        alt="Store Banner">

    @{
        var storeDetails = new StoreDetailsContainerDM
        {
            Image = $"/uploads/store/{Model.Image}",
            Name = Model.Name,
            Slug = Model.Slug,
            Rating = Model.Items.SelectMany(i => i.Reviews).Average(r => (decimal?)r.Rating) ?? 0m,
            TotalReviews = Model.Items.SelectMany(i => i.Reviews).Count(),
            Venue = Model.Venue.Name,
            JoinedAt = Model.CreatedAt,
        };
    }
    <partial name="_StoreDetailsContainer" model="@storeDetails" />
</div>

<div class="container">
    <div class="title">Description</div>
    <p style="white-space: pre-wrap;">@Model.Description</p>
</div>

<div class="container">
    <div class="title">Items</div>

    <div class="container listing-container" data-no="padding color" data-result-container>
        @foreach (var item in Model.Items.Where(i => i.IsActive))
        {
            var card = new ItemCardDM
            {
                Link = $"/Item/Info/{item.Slug}",
                Image = $"/uploads/item/{item.Image}",
                Name = item.Name,
                Rating = item.Reviews.Average(r => (decimal?)r.Rating) ?? 0m,
                Price = item.Variants.Select(v => (decimal?)v.Price).Min() ?? 0m,
                Sold = item.Variants.SelectMany(v => v.OrderItems).Sum(oi => (int?)oi.Quantity) ?? 0
            };
            <partial name="_ItemCard" model="@card" />
        }
    </div>

    <partial name="_NoResults" model="@("No items found in this store")" />
</div>